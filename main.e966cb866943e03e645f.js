"use strict";(self.webpackChunkpikachu_volleyball_p2p_online=self.webpackChunkpikachu_volleyball_p2p_online||[]).push([[792],{8007:(e,t,r)=>{var i=r(4603),n=r(6787),a=r(592),o=r(3650),s=r(9449),d=r(7561),l=r(7049),c=r(3401),u=r(8077),h=r(4697),y=r(8505),m=(r(7229),r(94)),p=r(9505),b=r(1275),g=r(6546),I=r(1514),w=r(7147),f=r(5345),S=r(1674),P=r(653);class C extends m.q{constructor(e,t){super(e,t),this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.keyboardArray[0].unsubscribe(),this.keyboardArray[1].unsubscribe(),this.myKeyboard=p.Uq,this.myOnlineKeyboard=new p.Nz(this.myKeyboard.inputQueue),this.peerOnlineKeyboard=new p.Nz(b.Ix.peerInputQueue),this._amIPlayer2=!1,this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard],this._syncCounter=0,this.noInputFrameTotal.menu=1/0,this.isFirstGame=!0,this.willSaveReplay=!0}get amIPlayer2(){return this._amIPlayer2}set amIPlayer2(e){this._amIPlayer2=e,b.Ix.amIPlayer2=e,!0===this._amIPlayer2?this.keyboardArray=[this.peerOnlineKeyboard,this.myOnlineKeyboard]:this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard]}get syncCounter(){return this._syncCounter}set syncCounter(e){this._syncCounter=(0,g.z)(e,b.fg)}intro(){0===this.frameCounter&&(this.selectedWithWho=0,this.isFirstGame?(this.isFirstGame=!1,this.amIPlayer2=!b.Ix.amICreatedRoom):b.Ix.isQuickMatch&&(0,I.Dj)()),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.amIPlayer2=!this.amIPlayer2,(0,w.sb)(b.Ix.myNickname,this.amIPlayer2),(0,w.Si)(b.Ix.peerNickname,!this.amIPlayer2),(0,w.UI)(b.Ix.myPartialPublicIP,this.amIPlayer2),(0,w.UI)(b.Ix.peerPartialPublicIP,!this.amIPlayer2),(0,P.yL)(),(0,w.ue)())}gameLoop(){b.Ix.gameStartAllowed&&b.Ix.isOpen&&(this.myKeyboard.getInputIfNeededAndSendToPeer(this.syncCounter),this.gameLoopFromGettingPeerInput())}gameLoopFromGettingPeerInput(){if(this.peerOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.myOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.peerOnlineKeyboard.getInput(this.syncCounter),this.myOnlineKeyboard.getInput(this.syncCounter),this.syncCounter++,this.willSaveReplay){const e=new S.BF;e.xDirection=this.keyboardArray[0].xDirection,e.yDirection=this.keyboardArray[0].yDirection,e.powerHit=this.keyboardArray[0].powerHit;const t=new S.BF;t.xDirection=this.keyboardArray[1].xDirection,t.yDirection=this.keyboardArray[1].yDirection,t.powerHit=this.keyboardArray[1].powerHit,f.Z.recordInputs(e,t)}if(this.slowMotionFramesLeft>0){if(this.slowMotionNumOfSkippedFrames++,this.slowMotionNumOfSkippedFrames%Math.round(this.normalFPS/this.slowMotionFPS)!=0)return;this.slowMotionFramesLeft--,this.slowMotionNumOfSkippedFrames=0}this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.state(),this.peerOnlineKeyboard.inputQueue.length>p.$g&&(this.myOnlineKeyboard.inputQueue.length>p.$g?window.setTimeout(this.gameLoopFromGettingPeerInput.bind(this),0):window.setTimeout(this.gameLoop.bind(this),0))}}else b.Ix.callbackAfterPeerInputQueueReceived=this.gameLoopFromGettingPeerInput.bind(this)}}var k=r(6090),O=r(6650),E=r(3398),v=r(6106);const A="stringifiedCustomBadWordListArrayView",x="isDefaultBadWordFilterEnabled",L=document.getElementById("basic-chat-filter-checkbox"),F=document.getElementById("blocked-bad-words-table-container"),N=document.querySelector("table.blocked-bad-words-table tbody"),D=document.querySelector("table.blocked-bad-words-table .delete-btn"),K=document.getElementById("number-of-bad-words-addresses"),_=document.getElementById("add-custom-word-btn"),T=document.getElementById("new-custom-word-input"),B=(0,E.j)();function W(){try{window.localStorage.setItem(A,JSON.stringify(v.v.createArrayView()))}catch(e){console.log(e)}}function R(e){if(N){for(;N.firstChild;)N.removeChild(N.firstChild);e.forEach(((e,t)=>{const r=document.createElement("tr"),i=document.createElement("td"),n=document.createElement("td");r.appendChild(i),r.appendChild(n),r.dataset.index=String(t),i.textContent=e[0],n.textContent=new Date(e[1]).toLocaleString(),N.appendChild(r)}))}}function M(){K&&(K.textContent=String(v.v.length))}const U=k.I.TEXTURES;U.WITH_COMPUTER=U.WITH_FRIEND,a.A4.registerPlugin("prepare",o.p8),a.A4.registerPlugin("batch",a.ch),u.KB.registerPlugin("prepare",y.S),u.KB.registerPlugin("sprite",h.$),d.aH.registerPlugin(l.A),i.W.RESOLUTION=2,i.W.SCALE_MODE=n.M6.NEAREST,i.W.ROUND_PIXELS=!0;const H=(0,a.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0}),G=new s.mc,Q=new c.Rv,q=new d.aH;document.querySelector("#game-canvas-container").appendChild(H.view),H.render(G),q.add(k.I.SPRITE_SHEET);for(const e in k.I.SOUNDS)q.add(k.I.SOUNDS[e]);function V(){const e=new C(G,q.resources);(0,I.zD)(e,Q),(0,P.yg)(e),function(e){Q.maxFPS=e.normalFPS,Q.add((()=>{H.render(G),e.gameLoop()})),Q.start()}(e)}!function(){const e=document.getElementById("loading-box"),t=document.getElementById("progress-bar");q.onProgress.add((()=>{t.style.width=`${q.progress}%`})),q.onComplete.add((()=>{e.classList.add("hidden")}))}(),b.Ix.callbackAfterDataChannelOpened=()=>{(function(){if(!B)return L&&L.parentElement.classList.add("hidden"),void(F&&F.classList.add("hidden"));!function(){if(!L)return;let e=!0;const t=window.localStorage.getItem(x);null!==t&&(e=JSON.parse(t)),L.checked=e,L.addEventListener("change",(()=>{try{window.localStorage.setItem(x,JSON.stringify(L.checked))}catch(e){console.log(e)}}))}(),function(){if(!(F&&D&&N&&K&&_&&T))return;D.disabled=!0;let e=null;try{e=window.localStorage.getItem(A)}catch(e){console.log(e)}if(null!==e){const t=JSON.parse(e);t.length>0&&2!==t[0].length?(window.localStorage.removeItem(A),location.reload()):v.v.readArrayViewAndUpdate(t)}R(v.v.createArrayView()),M(),document.body.addEventListener("click",(e=>{Array.from(N.getElementsByTagName("tr")).forEach((e=>{e.classList.remove("selected")})),D.disabled=!0;const t=e.target;N.contains(t)&&"TD"===t.tagName&&(t.parentElement.classList.add("selected"),D.disabled=!1)})),D.addEventListener("click",(()=>{const e=N.querySelector(".selected");e&&(v.v.removeAt(Number(e.dataset.index)),W(),R(v.v.createArrayView()),M())})),_.addEventListener("click",(()=>{const e=T.value;v.v.add(e)?(W(),R(v.v.createArrayView()),M(),T.value=""):console.log("Custom bad word add failed (duplicate, empty, or full).")}))}()})(),q.load(V)},(0,I.aW)(),(0,O.G)()}},e=>{e.O(0,[244,415,476],(()=>e(e.s=8007))),e.O()}]);
//# sourceMappingURL=main.e966cb866943e03e645f.js.map