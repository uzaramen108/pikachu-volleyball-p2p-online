{"version":3,"file":"main.93a52148281a9cb306b6.js","mappings":"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","sources":["webpack://pikachu-volleyball-p2p-online/./src/resources/js/pikavolley_online.js","webpack://pikachu-volleyball-p2p-online/./src/resources/js/bad_words_censorship/ui.js","webpack://pikachu-volleyball-p2p-online/./src/resources/js/main_online.js"],"sourcesContent":["\"use strict\";\nimport { PikachuVolleyball } from \"./offline_version_js/pikavolley.js\";\nimport { bufferLength, myKeyboard, OnlineKeyboard } from \"./keyboard_online.js\";\nimport { SYNC_DIVISOR, channel } from \"./data_channel/data_channel\";\nimport { mod } from \"./utils/mod.js\";\nimport { askOneMoreGame } from \"./ui_online.js\";\nimport {\n  displayPartialIPFor,\n  displayNicknameFor,\n  displayPeerNicknameFor,\n  displayMyAndPeerNicknameShownOrHidden,\n} from \"./nickname_display.js\";\nimport { replaySaver } from \"./replay/replay_saver.js\";\nimport { PikaUserInput } from \"./offline_version_js/physics.js\";\nimport { displayMyAndPeerChatEnabledOrDisabled } from \"./chat_display.js\";\n\n/** @typedef GameState @type {function():void} */\n\n/**\n * Class representing Pikachu Volleyball p2p online game\n */\n// @ts-ignore\nexport class PikachuVolleyballOnline extends PikachuVolleyball {\n  constructor(stage, resources) {\n    super(stage, resources);\n    this.physics.player1.isComputer = false;\n    this.physics.player2.isComputer = false;\n\n    // @ts-ignore\n    this.keyboardArray[0].unsubscribe();\n    // @ts-ignore\n    this.keyboardArray[1].unsubscribe();\n\n    this.myKeyboard = myKeyboard;\n    this.myOnlineKeyboard = new OnlineKeyboard(this.myKeyboard.inputQueue);\n    this.peerOnlineKeyboard = new OnlineKeyboard(channel.peerInputQueue);\n\n    this._amIPlayer2 = false;\n    this.keyboardArray = [this.myOnlineKeyboard, this.peerOnlineKeyboard];\n    this._syncCounter = 0;\n    this.noInputFrameTotal.menu = Infinity;\n\n    this.isFirstGame = true;\n\n    this.willSaveReplay = true;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  get amIPlayer2() {\n    return this._amIPlayer2;\n  }\n\n  /**\n   * @param {boolean} bool Am I Player 2? Am I play on the right side?\n   */\n  set amIPlayer2(bool) {\n    this._amIPlayer2 = bool;\n    channel.amIPlayer2 = bool;\n    if (this._amIPlayer2 === true) {\n      this.keyboardArray = [this.peerOnlineKeyboard, this.myOnlineKeyboard];\n    } else {\n      this.keyboardArray = [this.myOnlineKeyboard, this.peerOnlineKeyboard];\n    }\n  }\n\n  get syncCounter() {\n    return this._syncCounter;\n  }\n\n  set syncCounter(counter) {\n    this._syncCounter = mod(counter, SYNC_DIVISOR);\n  }\n\n  /**\n   * Override the \"intro\" method in the super class.\n   * It is to ask for one more game with the peer after quick match game ends.\n   * @type {GameState}\n   */\n  intro() {\n    if (this.frameCounter === 0) {\n      this.selectedWithWho = 0;\n      if (this.isFirstGame) {\n        this.isFirstGame = false;\n        this.amIPlayer2 = !channel.amICreatedRoom;\n      } else if (channel.isQuickMatch) {\n        askOneMoreGame();\n      }\n    }\n    super.intro();\n  }\n\n  /**\n   * Override the \"menu\" method in the super class.\n   * It changes \"am I player 1 or player 2\" setting accordingly.\n   * @type {GameState}\n   */\n  menu() {\n    const selectedWithWho = this.selectedWithWho;\n    super.menu();\n    if (this.selectedWithWho !== selectedWithWho) {\n      this.amIPlayer2 = !this.amIPlayer2;\n      displayNicknameFor(channel.myNickname, this.amIPlayer2);\n      displayPeerNicknameFor(channel.peerNickname, !this.amIPlayer2);\n      displayPartialIPFor(channel.myPartialPublicIP, this.amIPlayer2);\n      displayPartialIPFor(channel.peerPartialPublicIP, !this.amIPlayer2);\n      displayMyAndPeerChatEnabledOrDisabled();\n      displayMyAndPeerNicknameShownOrHidden();\n    }\n  }\n\n  /**\n   * Game loop\n   * This function should be called at regular intervals ( interval = (1 / FPS) second )\n   */\n  gameLoop() {\n    if (!(channel.gameStartAllowed && channel.isOpen)) {\n      return;\n    }\n\n    // Sync game frame and user input with peer\n    //\n    // This must be before the slow-mo effect.\n    // Otherwise, frame sync could be broken,\n    // for example, if peer use other tap on the browser\n    // so peer's game pause while my game goes on slow-mo.\n    // This broken frame sync results into different game state between two peers.\n    this.myKeyboard.getInputIfNeededAndSendToPeer(this.syncCounter);\n    this.gameLoopFromGettingPeerInput();\n  }\n\n  gameLoopFromGettingPeerInput() {\n    const checkForPeerInputQueue = this.peerOnlineKeyboard.isInputOnQueue(\n      this.syncCounter\n    );\n    if (!checkForPeerInputQueue) {\n      channel.callbackAfterPeerInputQueueReceived =\n        this.gameLoopFromGettingPeerInput.bind(this);\n      return;\n    }\n    const checkForMyInputQueue = this.myOnlineKeyboard.isInputOnQueue(\n      this.syncCounter\n    );\n    if (!checkForMyInputQueue) {\n      return;\n    }\n    this.peerOnlineKeyboard.getInput(this.syncCounter);\n    this.myOnlineKeyboard.getInput(this.syncCounter);\n    this.syncCounter++;\n\n    if (this.willSaveReplay) {\n      const player1Input = new PikaUserInput();\n      player1Input.xDirection = this.keyboardArray[0].xDirection;\n      player1Input.yDirection = this.keyboardArray[0].yDirection;\n      player1Input.powerHit = this.keyboardArray[0].powerHit;\n      const player2Input = new PikaUserInput();\n      player2Input.xDirection = this.keyboardArray[1].xDirection;\n      player2Input.yDirection = this.keyboardArray[1].yDirection;\n      player2Input.powerHit = this.keyboardArray[1].powerHit;\n      replaySaver.recordInputs(player1Input, player2Input);\n    }\n\n    // slow-mo effect\n    if (this.slowMotionFramesLeft > 0) {\n      this.slowMotionNumOfSkippedFrames++;\n      if (\n        this.slowMotionNumOfSkippedFrames %\n          Math.round(this.normalFPS / this.slowMotionFPS) !==\n        0\n      ) {\n        return;\n      }\n      this.slowMotionFramesLeft--;\n      this.slowMotionNumOfSkippedFrames = 0;\n    }\n\n    this.physics.player1.isComputer = false;\n    this.physics.player2.isComputer = false;\n    this.state();\n\n    // window.setTimeout(callback, 0) is used because it puts\n    // the callback to the message queue of Javascript runtime event loop,\n    // so the callback does not stack upon the stack of the caller function and\n    // also does not block if the callbacks are called a bunch in a row.\n    if (this.peerOnlineKeyboard.inputQueue.length > bufferLength) {\n      if (this.myOnlineKeyboard.inputQueue.length > bufferLength) {\n        window.setTimeout(this.gameLoopFromGettingPeerInput.bind(this), 0);\n      } else {\n        window.setTimeout(this.gameLoop.bind(this), 0);\n      }\n    }\n  }\n}\n","/**\n * Manages UI relevant to bad words censorship\n */\n\"use strict\";\n\nimport { getIfLocalStorageIsAvailable } from \"../utils/is_local_storage_available\";\nimport { customBadWordList } from \"./bad_word_list.js\";\n\nconst STORAGE_KEY_DEFAULT_FILTER_TOGGLE = \"isDefaultBadWordFilterEnabled\";\n\nconst defaultFilterToggle = document.getElementById(\n  \"basic-chat-filter-checkbox\"\n);\nconst customBadWordsTableContainer = document.getElementById(\n  \"blocked-bad-words-table-container\"\n);\nconst customBadWordsTableTbody = document.querySelector(\n  \"table.blocked-bad-words-table tbody\"\n);\nconst deleteCustomWordBtn = document.querySelector(\n  \"table.blocked-bad-words-table .delete-btn\"\n);\nconst customBadWordsCountSpan = document.getElementById(\n  \"number-of-bad-words-addresses\"\n);\n\nconst addCustomWordBtn = document.getElementById(\"add-custom-word-btn\");\nconst newCustomWordInput = document.getElementById(\"new-custom-word-input\");\n\nconst isLocalStorageAvailable = getIfLocalStorageIsAvailable();\n\nexport function setUpUIForManagingBadWords() {\n  if (!isLocalStorageAvailable) {\n    if (defaultFilterToggle) {\n      defaultFilterToggle.parentElement.classList.add(\"hidden\");\n    }\n    if (customBadWordsTableContainer) {\n      customBadWordsTableContainer.classList.add(\"hidden\");\n    }\n    return;\n  }\n\n  setUpDefaultFilterToggle();\n  setUpCustomFilterManagement();\n}\n\n/**\n * Set up toggle for using list of basic bad words at chat_filter.js\n */\nfunction setUpDefaultFilterToggle() {\n  if (!defaultFilterToggle) {\n    return;\n  }\n  let isEnabled = true;\n  const storedToggleState = window.localStorage.getItem(\n    STORAGE_KEY_DEFAULT_FILTER_TOGGLE\n  );\n  if (storedToggleState !== null) {\n    isEnabled = JSON.parse(storedToggleState);\n  }\n  // @ts-ignore\n  defaultFilterToggle.checked = isEnabled;\n  defaultFilterToggle.addEventListener(\"change\", () => {\n    try {\n      // @ts-ignore\n      window.localStorage.setItem(\n        STORAGE_KEY_DEFAULT_FILTER_TOGGLE,\n        // @ts-ignore\n        JSON.stringify(defaultFilterToggle.checked)\n      );\n    } catch (err) {\n      console.log(err);\n    }\n  });\n}\n\n/**\n * Set up table of bad words(delete, register)\n */\nfunction setUpCustomFilterManagement() {\n  if (\n    !customBadWordsTableContainer ||\n    !deleteCustomWordBtn ||\n    !customBadWordsTableTbody ||\n    !customBadWordsCountSpan ||\n    !addCustomWordBtn ||\n    !newCustomWordInput\n  ) {\n    return;\n  }\n\n  // @ts-ignore\n  deleteCustomWordBtn.disabled = true;\n\n  displayCustomBadWords(customBadWordList.createArrayView());\n  displayNumberOfCustomBadWords();\n\n  document.body.addEventListener(\"click\", (event) => {\n    Array.from(\n      // @ts-ignore\n      customBadWordsTableTbody.getElementsByTagName(\"tr\")\n    ).forEach((elem) => {\n      elem.classList.remove(\"selected\");\n    });\n    // @ts-ignore\n    deleteCustomWordBtn.disabled = true;\n    const target = event.target;\n    if (\n      // @ts-ignore\n      customBadWordsTableTbody.contains(target) &&\n      // @ts-ignore\n      target.tagName === \"TD\"\n    ) {\n      // @ts-ignore\n      target.parentElement.classList.add(\"selected\");\n      // @ts-ignore\n      deleteCustomWordBtn.disabled = false;\n    }\n  });\n  deleteCustomWordBtn.addEventListener(\"click\", () => {\n    // @ts-ignore\n    const selectedTRElement =\n      customBadWordsTableTbody.querySelector(\".selected\");\n    if (!selectedTRElement) {\n      return;\n    }\n    // @ts-ignore\n    customBadWordList.removeAt(Number(selectedTRElement.dataset.index));\n    displayCustomBadWords(customBadWordList.createArrayView());\n    displayNumberOfCustomBadWords();\n  });\n  addCustomWordBtn.addEventListener(\"click\", () => {\n    // @ts-ignore\n    const newWord = newCustomWordInput.value;\n\n    // customBadWordList.add returns true when it succeeds\n    if (customBadWordList.add(newWord)) {\n      displayCustomBadWords(customBadWordList.createArrayView());\n      displayNumberOfCustomBadWords();\n      // @ts-ignore\n      newCustomWordInput.value = \"\";\n    } else {\n      console.log(\"Custom bad word add failed (duplicate, empty, or full).\");\n    }\n  });\n}\n\n/**\n * Display the given bad word list array view.\n * @param {[string, number][]} badWords\n */\nfunction displayCustomBadWords(badWords) {\n  if (!customBadWordsTableTbody) {\n    return;\n  }\n  while (customBadWordsTableTbody.firstChild) {\n    customBadWordsTableTbody.removeChild(customBadWordsTableTbody.firstChild);\n  }\n  // Display the given list\n  badWords.forEach((badWord, index) => {\n    const trElement = document.createElement(\"tr\");\n    const tdElementForWord = document.createElement(\"td\");\n    const tdElementForTime = document.createElement(\"td\");\n    trElement.appendChild(tdElementForWord);\n    trElement.appendChild(tdElementForTime);\n    trElement.dataset.index = String(index);\n    tdElementForWord.textContent = badWord[0];\n    tdElementForTime.textContent = new Date(badWord[1]).toLocaleString();\n    customBadWordsTableTbody.appendChild(trElement);\n  });\n}\n\n/**\n * Display the number of bad words in the list\n */\nfunction displayNumberOfCustomBadWords() {\n  if (customBadWordsCountSpan) {\n    customBadWordsCountSpan.textContent = String(customBadWordList.length);\n  }\n}\n","/**\n * This is the main script which executes the p2p online version game.\n * General explanations for the all source code files of the game are following.\n *\n ********************************************************************************************************************\n * This p2p online version of the Pikachu Volleyball is developed based on\n * the Pikachu Volleyball offline web version (https://github.com/gorisanson/pikachu-volleyball)\n * which is made by reverse engineering the core part of the original Pikachu Volleyball game\n * which is developed by \"1997 (C) SACHI SOFT / SAWAYAKAN Programmers\" & \"1997 (C) Satoshi Takenouchi\".\n ********************************************************************************************************************\n *\n * This p2p online version game is mainly composed of two parts below.\n *  1) Offline version: All the offline web version source code files is in the directory \"offline_version_js\".\n *  2) WebRTC data channels: It utilizes WebRTC data channels to communicate with the peer.\n *                           The peer-to-peer online functions are contained in \"data_channel.js\"\n *\n * The game is deterministic on the user (keyboard) inputs except the RNG (random number generator) used in\n * \"offline_version_js/physics.js\" and \"offline_version_js/cloud_and_wave.js\". (The RNG is contained\n * in \"offline_version_js/rand.js\".) So if the RNG is the same on both peers, only the user inputs need\n * to be communicated to maintain the same game state between the peers. In this p2p online version, the RNG\n * is set to the same thing on both peers at the data channel open event (handled by the function\n * \"dataChannelOpened\" in \"data_channel.js\"), then the user inputs are communicated via the data channel.\n *\n * And explanations for other source files are below.\n *  - \"pikavolley_online.js\": A wrapper for \"offline_version_js/pikavolley.js\".\n *  - \"keyboard_online.js\": A wrapper for offline version \"offline_version_js/keyboard.js\".\n *                          This module gets user inputs and load them up onto the data channel to the peer.\n *  - \"generate_pushid.js\": Generate a room ID easily distinguishable by human eye.\n *  - \"mod.js\": To maintain game sync, sync counter is attached for each user input, and mod is used to\n *              make sync counter cycle in a range [0, 255] which fits in a byte.\n *  - \"ui_online.js\": For the user interface of the html page and inputs/outputs relevant to html elements.\n *  - \"chat_display.js\": For displaying chat messages.\n *  - \"firebase_config.template.js\": This p2p online version utilized firebase cloud firestore to establish\n *                                   webRTC data channel connection between peers. Fill this template and\n *                                   change the file name to \"firebase_config.js\".\n *  - \"rtc_configuration.js\": Contains RTCPeerConnection configuration.\n *  - \"quick_match.js\": It is for the quick match function. Manages communication with the quick match server.\n *  - \"quick_match_server_url.template.js\": Fill this template the url of the quick match server and change\n *                                          the file name to \"quick_match_server_url.js\"\n */\n\"use strict\";\nimport { settings } from \"@pixi/settings\";\nimport { SCALE_MODES } from \"@pixi/constants\";\nimport { Renderer, BatchRenderer, autoDetectRenderer } from \"@pixi/core\";\nimport { Prepare } from \"@pixi/prepare\";\nimport { Container } from \"@pixi/display\";\nimport { Loader } from \"@pixi/loaders\";\nimport { SpritesheetLoader } from \"@pixi/spritesheet\";\nimport { Ticker } from \"@pixi/ticker\";\nimport { CanvasRenderer } from \"@pixi/canvas-renderer\";\nimport { CanvasSpriteRenderer } from \"@pixi/canvas-sprite\";\nimport { CanvasPrepare } from \"@pixi/canvas-prepare\";\nimport \"@pixi/canvas-display\";\nimport { PikachuVolleyballOnline } from \"./pikavolley_online.js\";\nimport { ASSETS_PATH } from \"./offline_version_js/assets_path.js\";\nimport { channel } from \"./data_channel/data_channel.js\";\nimport { setUpUI, setUpUIAfterLoadingGameAssets } from \"./ui_online.js\";\nimport { setUpUIForBlockingOtherUsers } from \"./block_other_players/ui.js\";\nimport { setUpUIForManagingBadWords } from \"./bad_words_censorship/ui.js\";\nimport { setGetSpeechBubbleNeeded } from \"./chat_display.js\";\nimport \"../style.css\";\n\n// To show two \"with friend\" on the menu\nconst TEXTURES = ASSETS_PATH.TEXTURES;\nTEXTURES.WITH_COMPUTER = TEXTURES.WITH_FRIEND;\n\n// Reference for how to use Renderer.registerPlugin:\n// https://github.com/pixijs/pixijs/blob/af3c0c6bb15aeb1049178c972e4a14bb4cabfce4/bundles/pixi.js/src/index.ts#L27-L34\nRenderer.registerPlugin(\"prepare\", Prepare);\nRenderer.registerPlugin(\"batch\", BatchRenderer);\n// Reference for how to use CanvasRenderer.registerPlugin:\n// https://github.com/pixijs/pixijs/blob/af3c0c6bb15aeb1049178c972e4a14bb4cabfce4/bundles/pixi.js-legacy/src/index.ts#L13-L19\nCanvasRenderer.registerPlugin(\"prepare\", CanvasPrepare);\nCanvasRenderer.registerPlugin(\"sprite\", CanvasSpriteRenderer);\nLoader.registerPlugin(SpritesheetLoader);\n\nsettings.RESOLUTION = 2;\nsettings.SCALE_MODE = SCALE_MODES.NEAREST;\nsettings.ROUND_PIXELS = true;\n\nconst renderer = autoDetectRenderer({\n  width: 432,\n  height: 304,\n  antialias: false,\n  backgroundColor: 0x000000,\n  backgroundAlpha: 1,\n  // Decided to use only Canvas for compatibility reason. One player had reported that\n  // on their browser, where pixi chooses to use WebGL renderer, the graphics are not fine.\n  // And the issue had been fixed by using Canvas renderer. And also for the sake of testing,\n  // it is more comfortable just to stick with Canvas renderer so that it is unnecessary to switch\n  // between WebGL renderer and Canvas renderer.\n  forceCanvas: true,\n});\n\nconst stage = new Container();\nconst ticker = new Ticker();\nconst loader = new Loader();\n\ndocument.querySelector(\"#game-canvas-container\").appendChild(renderer.view);\nrenderer.render(stage); // To make the initial canvas painting stable in the Firefox browser.\n\nloader.add(ASSETS_PATH.SPRITE_SHEET);\nfor (const prop in ASSETS_PATH.SOUNDS) {\n  loader.add(ASSETS_PATH.SOUNDS[prop]);\n}\nsetUpLoaderProgressBar();\nchannel.callbackAfterDataChannelOpened = () => {\n  loader.load(setup);\n};\n\nsetUpUI();\nsetUpUIForBlockingOtherUsers();\nsetUpUIForManagingBadWords();\n\n/**\n * Set up the loader progress bar.\n */\nfunction setUpLoaderProgressBar() {\n  const loadingBox = document.getElementById(\"loading-box\");\n  const progressBar = document.getElementById(\"progress-bar\");\n\n  loader.onProgress.add(() => {\n    progressBar.style.width = `${loader.progress}%`;\n  });\n  loader.onComplete.add(() => {\n    loadingBox.classList.add(\"hidden\");\n  });\n}\n\nfunction setup() {\n  const pikaVolley = new PikachuVolleyballOnline(stage, loader.resources);\n  setUpUIAfterLoadingGameAssets(pikaVolley, ticker);\n  setGetSpeechBubbleNeeded(pikaVolley);\n  start(pikaVolley);\n}\n\nfunction start(pikaVolley) {\n  ticker.maxFPS = pikaVolley.normalFPS;\n  ticker.add(() => {\n    // Rendering and gameLoop order is the opposite of\n    // the offline web version (refer: ./offline_version_js/main.js).\n    // It's for the smooth rendering for the online version\n    // which gameLoop can not always succeed right on this \"ticker.add\"ed code\n    // because of the transfer delay or connection status. (If gameLoop here fails,\n    // it is recovered by the callback gameLoop which is called after peer input received.)\n    // Now the rendering is delayed 40ms (when pikaVolley.normalFPS == 25)\n    // behind gameLoop.\n    renderer.render(stage);\n    pikaVolley.gameLoop();\n  });\n  ticker.start();\n}\n"],"names":["PikachuVolleyballOnline","constructor","stage","resources","super","this","physics","player1","isComputer","player2","keyboardArray","unsubscribe","myKeyboard","myOnlineKeyboard","inputQueue","peerOnlineKeyboard","peerInputQueue","_amIPlayer2","_syncCounter","noInputFrameTotal","menu","Infinity","isFirstGame","willSaveReplay","amIPlayer2","bool","syncCounter","counter","mod","intro","frameCounter","selectedWithWho","amICreatedRoom","isQuickMatch","myNickname","peerNickname","myPartialPublicIP","peerPartialPublicIP","gameLoop","gameStartAllowed","isOpen","getInputIfNeededAndSendToPeer","gameLoopFromGettingPeerInput","isInputOnQueue","getInput","player1Input","xDirection","yDirection","powerHit","player2Input","recordInputs","slowMotionFramesLeft","slowMotionNumOfSkippedFrames","Math","round","normalFPS","slowMotionFPS","state","length","window","setTimeout","bind","callbackAfterPeerInputQueueReceived","STORAGE_KEY_DEFAULT_FILTER_TOGGLE","defaultFilterToggle","document","getElementById","customBadWordsTableContainer","customBadWordsTableTbody","querySelector","deleteCustomWordBtn","customBadWordsCountSpan","addCustomWordBtn","newCustomWordInput","isLocalStorageAvailable","displayCustomBadWords","badWords","firstChild","removeChild","forEach","badWord","index","trElement","createElement","tdElementForWord","tdElementForTime","appendChild","dataset","String","textContent","Date","toLocaleString","displayNumberOfCustomBadWords","TEXTURES","WITH_COMPUTER","WITH_FRIEND","registerPlugin","settings","RESOLUTION","SCALE_MODE","NEAREST","ROUND_PIXELS","renderer","width","height","antialias","backgroundColor","backgroundAlpha","forceCanvas","loader","view","render","add","SPRITE_SHEET","prop","SOUNDS","setup","pikaVolley","maxFPS","start","loadingBox","progressBar","onProgress","style","progress","onComplete","classList","setUpLoaderProgressBar","callbackAfterDataChannelOpened","load","parentElement","isEnabled","storedToggleState","localStorage","getItem","JSON","parse","checked","addEventListener","setItem","stringify","err","console","log","setUpDefaultFilterToggle","disabled","createArrayView","body","event","Array","from","getElementsByTagName","elem","remove","target","contains","tagName","selectedTRElement","removeAt","Number","newWord","value","setUpUIForManagingBadWords"],"sourceRoot":""}